var o,t,n,i,e=['{"board":[[2,2,2,2,2,2,2,2,2],[2,1,0,0,0,0,1,0,2],[2,0,1,0,0,0,0,1,2],[2,0,0,1,0,0,0,0,2],[2,0,0,0,1,0,0,0,2],[2,0,0,0,0,1,0,0,2],[2,1,0,0,0,0,1,0,2],[2,0,1,0,0,0,0,1,2],[2,2,2,2,2,2,2,2,2]],"rules":[{"kind":"connected","color":2},{"kind":"connected","color":1}],"symbols":[{"pos":{"x":1,"y":1},"kind":"viewpoint","count":3},{"pos":{"x":2,"y":2},"kind":"viewpoint","count":6},{"pos":{"x":3,"y":3},"kind":"viewpoint","count":4},{"pos":{"x":4,"y":4},"kind":"viewpoint","count":4},{"pos":{"x":5,"y":5},"kind":"viewpoint","count":4},{"pos":{"x":6,"y":6},"kind":"viewpoint","count":3},{"pos":{"x":7,"y":7},"kind":"viewpoint","count":6},{"pos":{"x":6,"y":1},"kind":"viewpoint","count":4},{"pos":{"x":7,"y":2},"kind":"viewpoint","count":7},{"pos":{"x":1,"y":6},"kind":"viewpoint","count":3},{"pos":{"x":2,"y":7},"kind":"viewpoint","count":6}],"sizeX":9,"sizeY":9}','{"board":[[0,0,0,1,0,1,0,0,2],[2,0,0,0,0,0,0,0,1],[1,0,1,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0,0],[1,0,0,2,0,0,0,0,0],[1,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0]],"rules":[{"kind":"connected","color":2}],"symbols":[{"pos":{"x":1,"y":1},"kind":"area","count":5},{"pos":{"x":2,"y":1},"kind":"dart","direction":"down","count":5},{"pos":{"x":1,"y":2},"kind":"viewpoint","count":5},{"pos":{"x":3,"y":3},"kind":"area","count":5},{"pos":{"x":4,"y":3},"kind":"dart","direction":"right","count":5},{"pos":{"x":3,"y":4},"kind":"viewpoint","count":5},{"pos":{"x":6,"y":6},"kind":"area","count":5},{"pos":{"x":7,"y":6},"kind":"dart","direction":"up","count":5},{"pos":{"x":6,"y":7},"kind":"viewpoint","count":5}],"sizeX":8,"sizeY":9}','{"board":[[0,0,1,0,0,0,0,0,0,1,1,0,0],[2,0,0,0,2,0,0,0,1,0,0,0,0],[0,0,0,0,1,0,0,0,1,0,0,0,1],[0,0,2,0,0,0,0,1,0,0,0,0,1],[0,1,0,0,0,2,0,1,0,0,1,1,0],[2,0,0,0,1,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,1,0,0,0,1,2,0,0,1],[0,1,0,0,0,1,0,1,0,0,2,0,0],[0,0,0,1,0,0,0,0,2,0,0,0,2],[0,0,1,0,0,0,0,1,0,0,0,1,0],[1,0,0,0,1,0,0,0,0,1,0,0,2],[0,1,0,0,0,1,0,2,0,0,1,2,0]],"rules":[{"kind":"connected","color":1}],"symbols":[{"kind":"viewpoint","pos":{"x":0,"y":2},"count":3},{"kind":"viewpoint","pos":{"x":1,"y":0},"count":1},{"kind":"viewpoint","pos":{"x":1,"y":4},"count":3},{"kind":"viewpoint","pos":{"x":2,"y":4},"count":3},{"kind":"viewpoint","pos":{"x":3,"y":2},"count":2},{"kind":"viewpoint","pos":{"x":4,"y":1},"count":4},{"kind":"viewpoint","pos":{"x":5,"y":0},"count":5},{"kind":"viewpoint","pos":{"x":7,"y":0},"count":9},{"kind":"viewpoint","pos":{"x":8,"y":1},"count":7},{"kind":"viewpoint","pos":{"x":11,"y":0},"count":6},{"kind":"viewpoint","pos":{"x":12,"y":1},"count":6},{"kind":"viewpoint","pos":{"x":10,"y":2},"count":5},{"kind":"viewpoint","pos":{"x":9,"y":3},"count":8},{"kind":"viewpoint","pos":{"x":7,"y":4},"count":5},{"kind":"viewpoint","pos":{"x":8,"y":5},"count":6},{"kind":"viewpoint","pos":{"x":11,"y":4},"count":5},{"kind":"viewpoint","pos":{"x":12,"y":5},"count":5},{"kind":"viewpoint","pos":{"x":5,"y":4},"count":2},{"kind":"viewpoint","pos":{"x":4,"y":5},"count":3},{"kind":"viewpoint","pos":{"x":1,"y":8},"count":3},{"kind":"viewpoint","pos":{"x":2,"y":8},"count":3},{"kind":"viewpoint","pos":{"x":3,"y":7},"count":2},{"kind":"viewpoint","pos":{"x":4,"y":7},"count":4},{"kind":"viewpoint","pos":{"x":5,"y":8},"count":4},{"kind":"viewpoint","pos":{"x":5,"y":9},"count":3},{"kind":"viewpoint","pos":{"x":4,"y":10},"count":6},{"kind":"viewpoint","pos":{"x":4,"y":11},"count":3},{"kind":"viewpoint","pos":{"x":3,"y":12},"count":3},{"kind":"viewpoint","pos":{"x":2,"y":12},"count":4},{"kind":"viewpoint","pos":{"x":0,"y":9},"count":2},{"kind":"viewpoint","pos":{"x":0,"y":10},"count":3},{"kind":"viewpoint","pos":{"x":7,"y":8},"count":4},{"kind":"viewpoint","pos":{"x":8,"y":7},"count":5},{"kind":"viewpoint","pos":{"x":10,"y":7},"count":5},{"kind":"viewpoint","pos":{"x":11,"y":9},"count":6},{"kind":"viewpoint","pos":{"x":12,"y":10},"count":3},{"kind":"viewpoint","pos":{"x":10,"y":11},"count":3},{"kind":"viewpoint","pos":{"x":7,"y":12},"count":3}],"sizeX":13,"sizeY":13}','{"board":[[2,0,0,0,0,1,0,0],[0,0,0,1,0,0,0,0],[0,1,0,0,1,0,1,0],[0,0,0,0,0,0,0,0],[0,0,1,0,1,0,0,1],[0,0,0,0,0,1,0,0],[0,0,0,1,0,0,0,0],[0,2,0,0,0,0,0,0],[1,0,0,0,0,0,0,0]],"rules":[{"kind":"area","color":2,"count":4}],"symbols":[{"kind":"lotus","pos":{"x":1,"y":3},"rotation":0},{"kind":"lotus","pos":{"x":0,"y":5},"rotation":0},{"kind":"lotus","pos":{"x":2,"y":6},"rotation":0},{"kind":"lotus","pos":{"x":4,"y":7},"rotation":0},{"kind":"lotus","pos":{"x":5,"y":5},"rotation":0},{"kind":"lotus","pos":{"x":6,"y":3},"rotation":0},{"kind":"lotus","pos":{"x":4,"y":2},"rotation":0},{"kind":"lotus","pos":{"x":2,"y":1},"rotation":3}],"sizeX":9,"sizeY":8}','{"board":[[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[2,1,0,0,0,0,0,0],[1,2,0,2,1,2,0,0],[0,0,0,1,2,1,0,0],[0,0,0,0,0,0,0,0]],"rules":[{"kind":"connected","color":2}],"symbols":[{"kind":"area","pos":{"x":2,"y":0},"count":3},{"kind":"area","pos":{"x":5,"y":0},"count":3},{"kind":"area","pos":{"x":4,"y":1},"count":8},{"kind":"area","pos":{"x":6,"y":3},"count":8},{"kind":"area","pos":{"x":5,"y":4},"count":3},{"kind":"area","pos":{"x":6,"y":5},"count":5},{"kind":"area","pos":{"x":0,"y":7},"count":8}],"sizeX":8,"sizeY":8}','{"board":[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,2,0,0,0,0,2,0],[0,0,0,2,0,0,0,0],[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0],[0,0,0,0,2,0,0,0],[0,0,0,0,0,0,0,0]],"rules":[{"kind":"area","color":2,"count":7}],"symbols":[{"kind":"galaxy","pos":{"x":2,"y":1}},{"kind":"galaxy","pos":{"x":3,"y":3}},{"kind":"galaxy","pos":{"x":2,"y":6}},{"kind":"galaxy","pos":{"x":6,"y":4}}],"sizeX":8,"sizeY":8}','{"board":[[3,3,1,1,1,1,1,1,1,1],[3,3,3,3,3,3,3,3,3,3],[1,3,0,0,0,1,0,1,0,0],[1,3,0,0,1,1,1,0,0,0],[1,3,2,0,0,1,0,0,1,0],[1,3,1,0,0,0,0,0,0,0],[1,3,0,0,0,0,0,0,2,1],[1,3,0,1,0,0,1,1,0,0],[1,3,0,0,0,0,1,1,0,0],[1,3,0,0,1,2,0,0,0,0]],"rules":[],"symbols":[{"kind":"dart","pos":{"x":2,"y":0},"count":4,"direction":"right"},{"kind":"dart","pos":{"x":3,"y":0},"count":4,"direction":"right"},{"kind":"dart","pos":{"x":4,"y":0},"count":4,"direction":"right"},{"kind":"dart","pos":{"x":5,"y":0},"count":4,"direction":"right"},{"kind":"dart","pos":{"x":6,"y":0},"count":4,"direction":"right"},{"kind":"dart","pos":{"x":7,"y":0},"count":4,"direction":"right"},{"kind":"dart","pos":{"x":8,"y":0},"count":4,"direction":"right"},{"kind":"dart","pos":{"x":9,"y":0},"count":4,"direction":"right"},{"kind":"dart","pos":{"x":0,"y":2},"count":4,"direction":"down"},{"kind":"dart","pos":{"x":0,"y":3},"count":4,"direction":"down"},{"kind":"dart","pos":{"x":0,"y":4},"count":4,"direction":"down"},{"kind":"dart","pos":{"x":0,"y":5},"count":4,"direction":"down"},{"kind":"dart","pos":{"x":0,"y":6},"count":4,"direction":"down"},{"kind":"dart","pos":{"x":0,"y":7},"count":4,"direction":"down"},{"kind":"dart","pos":{"x":0,"y":8},"count":4,"direction":"down"},{"kind":"dart","pos":{"x":0,"y":9},"count":4,"direction":"down"},{"kind":"lotus","pos":{"x":3,"y":4},"rotation":2},{"kind":"lotus","pos":{"x":3,"y":5},"rotation":3},{"kind":"lotus","pos":{"x":2,"y":7},"rotation":0},{"kind":"lotus","pos":{"x":6,"y":9},"rotation":0},{"kind":"lotus","pos":{"x":7,"y":3},"rotation":0},{"kind":"lotus","pos":{"x":4,"y":8},"rotation":1},{"kind":"lotus","pos":{"x":8,"y":6},"rotation":1},{"kind":"lotus","pos":{"x":8,"y":7},"rotation":3},{"kind":"lotus","pos":{"x":9,"y":4},"rotation":3},{"kind":"lotus","pos":{"x":5,"y":2},"rotation":3}],"sizeX":10,"sizeY":10}','{"board":[[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,0,0,0,0,0,0,1,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,2],[2,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2],[2,1,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,2],[2,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,1,0,1,0,2],[2,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,2],[2,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,2],[2,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,2],[2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,2],[2,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],[2,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,1,2],[2,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,2],[2,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,0,0,2],[2,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,2],[2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,2],[2,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2],[2,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,2],[2,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,2],[2,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,2],[2,0,1,0,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2],[2,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1,2],[2,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,2],[2,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,1,0,0,0,0,0,0,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]],"rules":[{"kind":"connected","color":2},{"kind":"connected","color":2}],"symbols":[{"kind":"viewpoint","pos":{"x":3,"y":1},"count":2},{"kind":"viewpoint","pos":{"x":2,"y":2},"count":6},{"kind":"viewpoint","pos":{"x":2,"y":4},"count":3},{"kind":"viewpoint","pos":{"x":2,"y":6},"count":3},{"kind":"viewpoint","pos":{"x":1,"y":7},"count":3},{"kind":"viewpoint","pos":{"x":1,"y":10},"count":4},{"kind":"viewpoint","pos":{"x":1,"y":15},"count":5},{"kind":"viewpoint","pos":{"x":1,"y":17},"count":3},{"kind":"viewpoint","pos":{"x":1,"y":20},"count":3},{"kind":"viewpoint","pos":{"x":2,"y":21},"count":2},{"kind":"viewpoint","pos":{"x":4,"y":4},"count":7},{"kind":"viewpoint","pos":{"x":5,"y":5},"count":3},{"kind":"viewpoint","pos":{"x":4,"y":8},"count":4},{"kind":"viewpoint","pos":{"x":3,"y":11},"count":9},{"kind":"viewpoint","pos":{"x":4,"y":12},"count":8},{"kind":"viewpoint","pos":{"x":3,"y":14},"count":8},{"kind":"viewpoint","pos":{"x":4,"y":16},"count":5},{"kind":"viewpoint","pos":{"x":5,"y":18},"count":7},{"kind":"viewpoint","pos":{"x":4,"y":19},"count":7},{"kind":"viewpoint","pos":{"x":4,"y":21},"count":2},{"kind":"viewpoint","pos":{"x":6,"y":21},"count":3},{"kind":"viewpoint","pos":{"x":7,"y":22},"count":5},{"kind":"viewpoint","pos":{"x":6,"y":1},"count":5},{"kind":"viewpoint","pos":{"x":8,"y":1},"count":3},{"kind":"viewpoint","pos":{"x":7,"y":4},"count":8},{"kind":"viewpoint","pos":{"x":9,"y":3},"count":6},{"kind":"viewpoint","pos":{"x":7,"y":8},"count":2},{"kind":"viewpoint","pos":{"x":9,"y":7},"count":2},{"kind":"viewpoint","pos":{"x":5,"y":10},"count":5},{"kind":"viewpoint","pos":{"x":6,"y":12},"count":3},{"kind":"viewpoint","pos":{"x":7,"y":14},"count":4},{"kind":"viewpoint","pos":{"x":8,"y":16},"count":6},{"kind":"viewpoint","pos":{"x":8,"y":19},"count":2},{"kind":"viewpoint","pos":{"x":10,"y":22},"count":5},{"kind":"viewpoint","pos":{"x":11,"y":20},"count":6},{"kind":"viewpoint","pos":{"x":10,"y":18},"count":5},{"kind":"viewpoint","pos":{"x":12,"y":19},"count":6},{"kind":"viewpoint","pos":{"x":12,"y":17},"count":6},{"kind":"viewpoint","pos":{"x":11,"y":13},"count":3},{"kind":"viewpoint","pos":{"x":10,"y":11},"count":7},{"kind":"viewpoint","pos":{"x":12,"y":10},"count":10},{"kind":"viewpoint","pos":{"x":13,"y":12},"count":3},{"kind":"viewpoint","pos":{"x":11,"y":6},"count":5},{"kind":"viewpoint","pos":{"x":11,"y":4},"count":3},{"kind":"viewpoint","pos":{"x":12,"y":3},"count":3},{"kind":"viewpoint","pos":{"x":13,"y":5},"count":5},{"kind":"viewpoint","pos":{"x":13,"y":1},"count":10},{"kind":"viewpoint","pos":{"x":15,"y":4},"count":8},{"kind":"viewpoint","pos":{"x":15,"y":7},"count":6},{"kind":"viewpoint","pos":{"x":16,"y":9},"count":6},{"kind":"viewpoint","pos":{"x":16,"y":1},"count":10},{"kind":"viewpoint","pos":{"x":17,"y":2},"count":2},{"kind":"viewpoint","pos":{"x":19,"y":2},"count":10},{"kind":"viewpoint","pos":{"x":21,"y":2},"count":9},{"kind":"viewpoint","pos":{"x":22,"y":3},"count":4},{"kind":"viewpoint","pos":{"x":19,"y":4},"count":7},{"kind":"viewpoint","pos":{"x":18,"y":5},"count":8},{"kind":"viewpoint","pos":{"x":19,"y":7},"count":11},{"kind":"viewpoint","pos":{"x":22,"y":6},"count":3},{"kind":"viewpoint","pos":{"x":22,"y":8},"count":5},{"kind":"viewpoint","pos":{"x":20,"y":9},"count":7},{"kind":"viewpoint","pos":{"x":19,"y":11},"count":12},{"kind":"viewpoint","pos":{"x":17,"y":11},"count":11},{"kind":"viewpoint","pos":{"x":20,"y":12},"count":7},{"kind":"viewpoint","pos":{"x":18,"y":13},"count":8},{"kind":"viewpoint","pos":{"x":22,"y":13},"count":9},{"kind":"viewpoint","pos":{"x":19,"y":15},"count":11},{"kind":"viewpoint","pos":{"x":22,"y":16},"count":9},{"kind":"viewpoint","pos":{"x":21,"y":17},"count":3},{"kind":"viewpoint","pos":{"x":21,"y":19},"count":3},{"kind":"viewpoint","pos":{"x":21,"y":21},"count":3},{"kind":"viewpoint","pos":{"x":20,"y":22},"count":9},{"kind":"viewpoint","pos":{"x":19,"y":19},"count":7},{"kind":"viewpoint","pos":{"x":18,"y":18},"count":5},{"kind":"viewpoint","pos":{"x":16,"y":19},"count":9},{"kind":"viewpoint","pos":{"x":17,"y":22},"count":4},{"kind":"viewpoint","pos":{"x":15,"y":22},"count":3},{"kind":"viewpoint","pos":{"x":14,"y":20},"count":5},{"kind":"viewpoint","pos":{"x":14,"y":16},"count":11},{"kind":"viewpoint","pos":{"x":16,"y":15},"count":6}],"sizeX":24,"sizeY":24}'];function r(o,t){return t.x>=0&&t.x<o.length&&t.y>=0&&t.y<o[0].length}function d(o){return 2==o?1:2}function p(o,t){let n=[];return t.x>0&&3!=o[t.x-1][t.y]&&n.push({x:t.x-1,y:t.y}),t.x+1<o.length&&3!=o[t.x+1][t.y]&&n.push({x:t.x+1,y:t.y}),t.y>0&&3!=o[t.x][t.y-1]&&n.push({x:t.x,y:t.y-1}),t.y+1<o[0].length&&3!=o[t.x][t.y+1]&&n.push({x:t.x,y:t.y+1}),n}function s(o){switch(o){case"up":return[-1,0];case"down":return[1,0];case"left":return[0,-1];case"right":return[0,1]}}function u(o,t){let i=[];for(let t=0;t<o.length;t++){i[t]=[];for(let n=0;n<o[0].length;n++)i[t][n]=!1}for(let e=0;e<o.length;e++)for(let r=0;r<o[0].length;r++)if(!i[e][r]&&o[e][r]==t.color&&!function(o,t,i,e,r){let d=[t],s=[],u=0,l=0,y=[];for(let t=0;t<o.length;t++){y[t]=[];for(let n=0;n<o[0].length;n++)y[t][n]=!1}for(y[t.x][t.y]=!0,r[t.x][t.y]=!0;d.length>0;)for(let t of(u+=1,p(o,d.pop()))){if(y[t.x][t.y])continue;let e=o[t.x][t.y];e==n.Empty?s.push(t):e==i&&(d.push(t),r[t.x][t.y]=!0),y[t.x][t.y]=!0}if(u>e)return!1;for(;s.length>0;){let t=s.pop();if(u+(l+=1)>=e)return!0;for(let e of p(o,t)){if(y[e.x][e.y])continue;let t=o[e.x][e.y];(t==n.Empty||t==i)&&(s.push(e),y[e.x][e.y]=!0)}}return u+l>=e}(o,{x:e,y:r},t.color,t.count,i))return!1;return!0}function l(o,t){let n=[];for(let i=0;i<o.length;i++)for(let e=0;e<o[0].length;e++)o[i][e]==t.color&&n.push({x:i,y:e});if(0===n.length)return!0;let i=[n[0]],e=[];for(let t=0;t<o.length;t++){e[t]=[];for(let n=0;n<o[0].length;n++)e[t][n]=!1}for(e[n[0].x][n[0].y]=!0;i.length>0;)for(let n of p(o,i.pop()))e[n.x][n.y]||o[n.x][n.y]==d(t.color)||(e[n.x][n.y]=!0,i.push(n));for(let o of n)if(!e[o.x][o.y])return!1;return!0}function y(o,t){let i=t.pos,e=o[i.x][i.y];if(e==n.Empty)return[t.pos];let r=[],d=[i],s=[],u=0,l=0;for(let t=0;t<o.length;t++){r[t]=[];for(let n=0;n<o[0].length;n++)r[t][n]=!1}for(r[i.x][i.y]=!0;d.length>0;)for(let t of(u+=1,p(o,d.pop()))){if(r[t.x][t.y])continue;let i=o[t.x][t.y];i==n.Empty?s.push(t):i==e&&d.push(t),r[t.x][t.y]=!0}if(u>t.count)return!1;let y=[...s];for(;s.length>0;){let i=s.pop();if(u+(l+=1)>=t.count)return y;for(let t of p(o,i)){if(r[t.x][t.y])continue;let i=o[t.x][t.y];(i==n.Empty||i==e)&&(s.push(t),r[t.x][t.y]=!0)}}return u+l>=t.count&&y}function c(o,t){let i=t.pos,e=o[i.x][i.y];if(e==n.Empty)return!0;let[p,u]=s(t.direction),l=i.x+p,y=i.y+u,c=0,x=0;for(;r(o,{x:l,y:y});){if(d(e)==o[l][y]&&(c+=1)>t.count)return!1;o[l][y]==n.Empty&&(x+=1),l+=p,y+=u}return c+x>=t.count}function x(o,t){let i=t.pos,e=o[i.x][i.y];if(e==n.Empty)return[t.pos];let p=1,s=1,u=[];function l(l,y){let c=!0,x=i.x+l,a=i.y+y;for(;r(o,{x:x,y:a});){let i=o[x][a];if(c){if(e==i){if((s+=1)>t.count)return!0}else i==n.Empty&&u.push({x:x,y:a}),c=!1}if(d(e)==i||i==n.Border)break;p+=1,x+=l,a+=y}return!1}return!(l(-1,0)||l(1,0)||l(0,-1)||l(0,1))&&!(p<t.count)&&u}function a(o,t){let i=t.pos,e=o[i.x][i.y];if(e==n.Empty)return[i];let d=[i],s=[],u=[];for(let t=0;t<o.length;t++){s[t]=[];for(let n=0;n<o[0].length;n++)s[t][n]=!1}for(;d.length>0;){let i=d.pop();if(s[i.x][i.y])continue;s[i.x][i.y]=!0;let l=function(o,t,n){let i={x:2*t.pos.x-n.x,y:2*t.pos.y-n.y};return r(o,i)?i:null}(o,t,i);if(null==l||!(o[l.x][l.y]==n.Empty||o[l.x][l.y]==e))return!1;for(let t of p(o,i))s[t.x][t.y]||(o[t.x][t.y]==n.Empty?u.push(t):o[t.x][t.y]==e&&d.push(t))}return u}function k(o,t){let i=t.pos,e=o[i.x][i.y];if(e==n.Empty)return[i];let d=[i],s=[],u=[];for(let t=0;t<o.length;t++){s[t]=[];for(let n=0;n<o[0].length;n++)s[t][n]=!1}for(;d.length>0;){let i=d.pop();if(s[i.x][i.y])continue;s[i.x][i.y]=!0;let l=function(o,t,n){let i;return 0==t.rotation?i={x:n.x,y:2*t.pos.y-n.y}:1==t.rotation?i={x:t.pos.x+t.pos.y-n.y,y:t.pos.x+t.pos.y-n.x}:2==t.rotation?i={x:2*t.pos.x-n.x,y:n.y}:3==t.rotation&&(i={x:t.pos.x-t.pos.y+n.y,y:t.pos.y-t.pos.x+n.x}),r(o,i)?i:null}(o,t,i);if(null==l||!(o[l.x][l.y]==n.Empty||o[l.x][l.y]==e))return!1;for(let t of p(o,i))s[t.x][t.y]||(o[t.x][t.y]==n.Empty?u.push(t):o[t.x][t.y]==e&&d.push(t))}return u}function f(o,t,i,e,r){if(t[i.x][i.y])for(let n of t[i.x][i.y])if("dart"==n.symbol.kind){if(!c(o.board,n.symbol))return!1}else{let t;if("area"==n.symbol.kind?t=y(o.board,n.symbol):"viewpoint"==n.symbol.kind?t=x(o.board,n.symbol):"galaxy"==n.symbol.kind?t=a(o.board,n.symbol):"lotus"==n.symbol.kind&&(t=k(o.board,n.symbol)),!t)return!1;r.push([n,n.affectedCells]),n.affectedCells=t}for(let r of o.symbols)if("area"==r.kind){let d=o.board[r.pos.x][r.pos.y];if(d==n.Empty||d==e||t[i.x][i.y]?.find(o=>o.symbol==r))continue;if(!y(o.board,r))return!1}for(let t of o.rules)if("connected"==t.kind&&!l(o.board,t)||"area"==t.kind&&!u(o.board,t))return!1;return!0}function v(o){for(let[t,n]of o)t.affectedCells=n}(o=n||(n={}))[o.Empty=0]="Empty",o[o.Light=1]="Light",o[o.Dark=2]="Dark",o[o.Border=3]="Border",(t=i||(i={})).Up="up",t.Down="down",t.Left="left",t.Right="right";const w=document.getElementById("board"),h=w.getBoundingClientRect(),m=w.getContext("2d");let b=B(10,10),g=!1,E=n.Empty;function z(o){w.width!=50*o.sizeY&&(w.width=50*o.sizeY),w.height!=50*o.sizeX&&(w.height=50*o.sizeX),m.clearRect(0,0,w.width,w.height);for(let t=0;t<o.sizeX;t++)for(let i=0;i<o.sizeY;i++){let e=50*i,r=50*t,d=function(o){switch(o){case n.Empty:return"#A0A0A0";case n.Light:return"#FFFFFF";case n.Dark:return"#202020";case n.Border:return"#404040"}}(o.board[t][i]);m.fillStyle=d,m.fillRect(e,r,50,50),m.strokeStyle="#404040",m.strokeRect(e,r,50,50)}for(let t of o.symbols){let i=50*t.pos.y,e=50*t.pos.x;if(m.fillStyle=o.board[t.pos.x][t.pos.y]==n.Dark?"white":"black",m.textAlign="center",m.textBaseline="middle",("area"==t.kind||"viewpoint"==t.kind||"dart"==t.kind)&&(m.font="bold "+Math.floor(25)+"px Arial",m.fillText(t.count.toString(),i+25,e+25)),"lotus"==t.kind){let o;m.font="bold "+Math.floor(25)+"px Arial",0==t.rotation?o="↕":1==t.rotation?o="⤢":2==t.rotation?o="↔":3==t.rotation&&(o="⤡"),m.fillText(o,i+25,e+25)}if("area"!=t.kind){m.font=Math.floor(12.5)+"px Arial";let o=t.kind;"dart"==t.kind&&("up"==t.direction?o+=" ↑":"down"==t.direction?o+=" ↓":"left"==t.direction?o+=" ←":"right"==t.direction&&(o+=" →")),m.fillText(o,i+25,e+40)}}}function L(o){let t=o.pageX-h.left,n=Math.floor((o.pageY-h.top)/50),i=Math.floor(t/50);return n<0||n>=b.sizeX||i<0||i>=b.sizeY?null:{x:n,y:i}}function I(){let o=parseInt(document.getElementById("size-x").value),t=parseInt(document.getElementById("size-y").value);if(isNaN(o)||isNaN(t)||o<1||t<1){alert("Invalid size!");return}z(b=B(o,t)),D()}function B(o,t){let i=[];for(let e=0;e<o;e++){i.push([]);for(let o=0;o<t;o++)i[e].push(n.Empty)}return{board:i,rules:[],symbols:[],sizeX:o,sizeY:t}}function X(){return document.getElementById("item-select").value}function Y(o,t){let n=document.createElement("input");n.id="input-box",n.style.left=`${o.pageX}px`,n.style.top=`${o.pageY}px`,document.body.appendChild(n),window.requestAnimationFrame(()=>n.focus()),n.addEventListener("keydown",o=>{if("Enter"!=o.key)return;let i=n.value;n.blur(),t(i)}),n.addEventListener("blur",()=>{n.remove()})}function D(){let o=document.getElementById("rule-list");for(let t of(o.innerHTML="",b.rules)){let i=document.createElement("li");"connected"==t.kind?i.textContent=`Connect all ${t.color==n.Dark?"dark":"light"} cells`:"area"==t.kind&&(i.textContent=`All ${t.color==n.Dark?"dark":"light"} regions have area ${t.count}`),o.appendChild(i)}}z(b),D(),w.addEventListener("mousedown",function(o){if("cell"!=X()&&"border"!=X())return;g=!0,"border"==X()?0==o.button?E=n.Border:2==o.button&&(E=n.Empty):0==o.button?E=n.Dark:2==o.button?E=n.Light:1==o.button&&(E=n.Empty);let t=L(o);t&&(b.board[t.x][t.y]=E,z(b))}),window.addEventListener("mouseup",function(){("cell"==X()||"border"==X())&&(g=!1)}),w.addEventListener("mousemove",function(o){if("cell"!=X()&&"border"!=X()||!g)return;let t=L(o);t&&(b.board[t.x][t.y]=E,z(b))}),w.addEventListener("contextmenu",o=>o.preventDefault()),document.getElementById("reset-button").addEventListener("click",I),document.getElementById("add-rule-button").addEventListener("click",function(o){let t=document.getElementById("rule-select").value;"connected dark"==t?(b.rules.push({kind:"connected",color:n.Dark}),D()):"connected light"==t?(b.rules.push({kind:"connected",color:n.Light}),D()):("area dark"==t||"area light"==t)&&Y(o,o=>{let i=parseInt(o);isNaN(i)||i<1||("area dark"==t?b.rules.push({kind:"area",color:n.Dark,count:i}):"area light"==t&&b.rules.push({kind:"area",color:n.Light,count:i}),D())})}),document.getElementById("clear-rules-button").addEventListener("click",function(){b.rules=[],D()}),document.getElementById("preset-select").addEventListener("change",function(o){let t=o.target.value;"none"==t?I():b=JSON.parse(e[parseInt(t)-1]),z(b),D()}),document.getElementById("import-button").addEventListener("click",function(o){Y(o,o=>{if(""!=o)try{b=JSON.parse(o),z(b),D()}catch(o){console.error(o),alert("Import failed! See console for more details.")}})}),document.getElementById("export-button").addEventListener("click",function(){console.log(JSON.stringify(b)),alert("Game has been printed to the console.\nPress Ctrl+Shift+I to view it.")}),document.getElementById("solve-button").addEventListener("click",function(){console.log("Solving the game..."),console.time();let o=function(o){if(!function(o){for(let t of o.rules)if("connected"==t.kind&&!l(o.board,t)||"area"==t.kind&&!u(o.board,t))return!1;for(let t of o.symbols)if("area"==t.kind&&!y(o.board,t)||"dart"==t.kind&&!c(o.board,t)||"viewpoint"==t.kind&&!x(o.board,t)||"galaxy"==t.kind&&!a(o.board,t)||"lotus"==t.kind&&!k(o.board,t))return!1;return!0}(o))return!1;let t=[];for(let i of o.symbols){let e;if("area"==i.kind?e=y(o.board,i):"dart"==i.kind?e=function(o,t){let i=[],[e,d]=s(t.direction),p=t.pos.x,u=t.pos.y;for(;r(o,{x:p,y:u});)o[p][u]==n.Empty&&i.push({x:p,y:u}),p+=e,u+=d;return i}(o.board,i):"viewpoint"==i.kind?e=x(o.board,i):"galaxy"==i.kind?e=a(o.board,i):"lotus"==i.kind&&(e=k(o.board,i)),!e)return!1;t.push({symbol:i,affectedCells:e})}return function o(t,i){let e=function(o,t){let i=[];for(let t=0;t<o.sizeX;t++){i[t]=[];for(let n=0;n<o.sizeY;n++)i[t][n]=null}for(let e of t)for(let t of e.affectedCells)o.board[t.x][t.y]==n.Empty&&(i[t.x][t.y]||(i[t.x][t.y]=[]),i[t.x][t.y].push(e));return i}(t,i),r=function(o,t){let i=0,e=null;for(let n=0;n<o.sizeX;n++)for(let r=0;r<o.sizeY;r++)t[n][r]&&t[n][r].length>i&&(i=t[n][r].length,e={x:n,y:r});return e||function(o){for(let t=0;t<o.sizeX;t++)for(let i=0;i<o.sizeY;i++)if(o.board[t][i]===n.Empty)return{x:t,y:i};return null}(o)}(t,e);if(!r)return!0;{let d=[];if(t.board[r.x][r.y]=n.Light,f(t,e,r,n.Light,d)&&o(t,i))return!0;v(d)}{let d=[];if(t.board[r.x][r.y]=n.Dark,f(t,e,r,n.Dark,d)&&o(t,i))return!0;v(d)}return t.board[r.x][r.y]=n.Empty,!1}(o,t)}(b);console.timeEnd(),o||alert("No valid solutions found!"),z(b)}),w.addEventListener("mousedown",function(o){let t=X();if("cell"==t||"border"==t)return;let n=L(o);if(n){if(2==o.button)b.symbols=b.symbols.filter(o=>o.pos.x!=n.x||o.pos.y!=n.y);else if(0==o.button){let e;if("area"==t||"viewpoint"==t||"dart 0"==t||"dart 1"==t||"dart 2"==t||"dart 3"==t){Y(o,o=>{let e;let r=parseInt(o);isNaN(r)||r<1||("area"==t?e={kind:"area",pos:n,count:r}:"viewpoint"==t?e={kind:"viewpoint",pos:n,count:r}:"dart 0"==t?e={kind:"dart",pos:n,count:r,direction:i.Up}:"dart 1"==t?e={kind:"dart",pos:n,count:r,direction:i.Down}:"dart 2"==t?e={kind:"dart",pos:n,count:r,direction:i.Left}:"dart 3"==t&&(e={kind:"dart",pos:n,count:r,direction:i.Right}),b.symbols=b.symbols.filter(o=>o.pos.x!=n.x||o.pos.y!=n.y),b.symbols.push(e),z(b))});return}"galaxy"==t?e={kind:"galaxy",pos:n}:"lotus 0"==t?e={kind:"lotus",pos:n,rotation:0}:"lotus 1"==t?e={kind:"lotus",pos:n,rotation:1}:"lotus 2"==t?e={kind:"lotus",pos:n,rotation:2}:"lotus 3"==t&&(e={kind:"lotus",pos:n,rotation:3}),b.symbols=b.symbols.filter(o=>o.pos.x!=n.x||o.pos.y!=n.y),b.symbols.push(e)}z(b)}});
//# sourceMappingURL=index.89240e7d.js.map
